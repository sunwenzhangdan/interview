<!--
 * @Date: 2021-05-10 08:42:32
 * @LastEditors: seven sun 
 * @LastEditTime: 2022-02-09 19:53:50
 * @FilePath: /interview/mysql/mysql.md
-->
记住没有磁盘操作系统是可以运行的，程序其实只在内存中运行，磁盘只是无力化永久保存，对内存磁盘的认识就是

innodb 的重要内存结构：缓存池
innodb存储引擎，buffer pool缓存池，会缓存数据，如果内存中有数据就不去查磁盘了
现在我们有这样的语句 update form set name="" where id=10,我们在更新id为10的这条数据，如果内存在没有
会先将数据加载到缓存池中来，接着会对这条记录加独占锁，进行更新。

mysql重要的名词
undo日志 为什么要有undo日志呢，就是如果我们执行的语句放在一个事务里面，那么提交之前需要对数据进行回滚，为了能够回滚，我们其实就是做了日志
更新的时候操作时这样的 我们先对缓存池的值进行更新了，undo日志保存以前的值，但是呢现在磁盘的值还是原来的值
其实现在对于客户端调用返回的已经是调用成功，但是如果此时宕机了，数据其实没写到磁盘里，于是呢又诞生了一个新的名词
redo buffer log也是一个内存缓冲区，就是存放对内存所做的修改。保存的是更改后的值

mysql 执行一条sql语句，其实也是一个独立的事务。只有当提价事务之后，sql语句才算结束。
提交事务的时候，将redo日志刷到磁盘里。但是此时呢mysql文件块并没有修改，默认日志进去，则数据就去了。（通过一个参数可以来设置）
mysql binlog
binlog 叫做归档日志，它里面更是逻辑性的日志，是属于mysql server自己的日志，redo log是innodb引擎的日志
提交事务的时候同样会把binlog日志写到磁盘文件中。




1. 大表查询数据怎么做优化
   优化schema sql语句+索引
   加缓存 redis 
   主从复制，读写分离
   水平拆分，合理选择sharding key

2. mysql 事务与隔离
多个事务同时执行可能会出现的情况
事务的特性
原子性
一致性
隔离性 不受外部多线程影响
持久性



第一种什么都不管，别人修改了了就能读到不管提没提交
读未提交
第二种 只要提交了就能读到
第三种 可重复读就是我这边第一次读到的，只要在未提交自己的事务之前一直读到的是刚开始事务的值
第四种 串行话 就是一个事务完了 另一个事务才可以开始，加锁了。




3. mysql 锁详解

4. 为什么要用b树作索引
B-tree是磁盘外存储设备的一种平衡查找树，系统从磁盘读数据是按磁盘块
理解inode，要从文件储存说起。
 文件储存在硬盘上，硬盘的最小存储单位叫做"扇区"（即：Sector）。每个扇区储存512字节（相当于0.5KB）。
 操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个"块"（block）。这种由多个扇区组成的"块"，是文件存取的最小单位。"块"的大小，最常见的是4KB，即连续八个 sector组成一个 block。
 文件数据都储存在"块"中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为"索引节点"。
 block中存储的就是文件的实际数据，比如说，照片，视频，音频等等，但是有一点需要注意！就是inode当中不包含文件名！一个文件的文件名，存储在上级目录的block中！
 其实inode和block之间的关系就像是一本书一样，inode是一本书的目录，一本书会有很多内容，一个知识点或者一个故事会占很多页，一个block就相当于书中的一页内容。

block为基本单位的，位于同一个磁盘块中的数据会被一次性读出来，innoDb一次读取的大小是默认16kb(page 页),如果数据量很大的时候，索引会变得很大，不可能一次性把索引数据加大内存，需要一次一次把数据加载到内存，索引的节点对应二叉树节点，
每一次读一次数据拿出来比较一次都是一次io

5. 数据的同步,主要是防止 cpu cpu缓存  内存 磁盘的不一致，因为读取的速度差异很大，
   所以同步



kubeadm init \
--apiserver-advertise-address=10.211.55.7 \
--control-plane-endpoint=k8s-master \
--image-repository registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images \
--kubernetes-version v1.20.9 \
--service-cidr=10.96.0.0/16 \
--pod-network-cidr=192.168.0.0/16